
import os
import utilities as ut
import matplotlib.pyplot as plt
import matplotlib.colors as mcolors
import matplotlib.patches as patches
from labellines import labelLines
from collections import defaultdict
from datetime import datetime

version = '2.0'
figID   = 'f0001'

def split_and_plot(delineators, y_values, x_values, objective=True, savefig=True):
    date = datetime.now()
    path = os.path.join(os.getcwd(), "Figures and Data")
    
    if objective: 
        baseline = 0.0562989 * 1000
        plt.scatter(1.0, baseline, color='#333333', s=20, zorder=5, label="Baseline PHX")

    plt.legend()
    for line in plt.gca().get_lines():
        line.set_label(None)

    colors = ut.colorGenerator(factor=0.06)
    subsets = defaultdict(list)
    for i, d in enumerate(delineators):
        subsets[d].append(y_values[i])
    
    for i, (key, subset) in enumerate(subsets.items()):
        x_subset = x_values[:len(subset)]
        plt.plot(x_subset, subset, color=next(colors), label=f"{key:.0f}")
    
    labelLines(plt.gca().get_lines(), align=True, zorder=2.5, fontsize=6)

    firstColor = next(colors)
    lastColor  = '#6bffa9'
    firstTemp  = min(delineators)
    lastTemp   = max(delineators)

    cmap = mcolors.LinearSegmentedColormap.from_list("custom", [firstColor, lastColor])
    norm = mcolors.Normalize(vmin=firstTemp, vmax=lastTemp)

    cbar = plt.colorbar(plt.cm.ScalarMappable(norm=norm, cmap=cmap), ax=plt.gca())
    cbar.set_label('PHX Hot Inlet Temperature [C]')

    plt.xlabel(r'[\$ / UA(SiC)] / [\$ / UA(typ)]')
    plt.ylabel('Levelized Cost of Energy [$/MW-h]')
    plt.grid()
    plt.margins(x=0)

    if savefig: plt.savefig(os.path.join(path, "figures", f"{figID}_V{version}_LCOE-vs-cost-per-UA.png"), dpi=300, bbox_inches='tight')
    plt.show()

cost_model = [
    4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0
]
TIT = [
    600.0, 600.0, 600.0, 600.0, 600.0, 600.0, 600.0, 600.0, 600.0, 600.0, 600.0, 620.0, 620.0, 620.0, 620.0, 620.0, 620.0, 620.0, 620.0, 620.0, 620.0, 620.0, 640.0, 640.0, 640.0, 640.0, 640.0, 640.0, 640.0, 640.0, 640.0, 640.0, 640.0, 660.0, 660.0, 660.0, 660.0, 660.0, 660.0, 660.0, 660.0, 660.0, 660.0, 660.0, 680.0, 680.0, 680.0, 680.0, 680.0, 680.0, 680.0, 680.0, 680.0, 680.0, 680.0, 700.0, 700.0, 700.0, 700.0, 700.0, 700.0, 700.0, 700.0, 700.0, 700.0, 700.0, 720.0, 720.0, 720.0, 720.0, 720.0, 720.0, 720.0, 720.0, 720.0, 720.0, 720.0, 740.0, 740.0, 740.0, 740.0, 740.0, 740.0, 740.0, 740.0, 740.0, 740.0, 740.0, 760.0, 760.0, 760.0, 760.0, 760.0, 760.0, 760.0, 760.0, 760.0, 760.0, 760.0, 780.0, 780.0, 780.0, 780.0, 780.0, 780.0, 780.0, 780.0, 780.0, 780.0, 780.0, 800.0, 800.0, 800.0, 800.0, 800.0, 800.0, 800.0, 800.0, 800.0, 800.0, 800.0, 820.0, 820.0, 820.0, 820.0, 820.0, 820.0, 820.0, 820.0, 820.0, 820.0, 820.0, 840.0, 840.0, 840.0, 840.0, 840.0, 840.0, 840.0, 840.0, 840.0, 840.0, 840.0, 860.0, 860.0, 860.0, 860.0, 860.0, 860.0, 860.0, 860.0, 860.0, 860.0, 860.0, 880.0, 880.0, 880.0, 880.0, 880.0, 880.0, 880.0, 880.0, 880.0, 880.0, 880.0, 900.0, 900.0, 900.0, 900.0, 900.0, 900.0, 900.0, 900.0, 900.0, 900.0, 900.0, 920.0, 920.0, 920.0, 920.0, 920.0, 920.0, 920.0, 920.0, 920.0, 920.0, 920.0, 940.0, 940.0, 940.0, 940.0, 940.0, 940.0, 940.0, 940.0, 940.0, 940.0, 940.0, 960.0, 960.0, 960.0, 960.0, 960.0, 960.0, 960.0, 960.0, 960.0, 960.0, 960.0, 980.0, 980.0, 980.0, 980.0, 980.0, 980.0, 980.0, 980.0, 980.0, 980.0, 980.0, 1000.0, 1000.0, 1000.0, 1000.0, 1000.0, 1000.0, 1000.0, 1000.0, 1000.0, 1000.0, 1000.0
]
LCOE = [
    59.241404345892235, 59.99602581840293, 60.75064729091362, 61.505268763424326, 62.259890235935, 63.0145117084457, 63.76913318095641, 64.52375465346708, 65.27837612597779, 66.03299759848848, 66.78761907099916, 57.68097429207652, 58.44333206860253, 59.205689845128525, 59.96804762165451, 60.73040539818052, 61.49276317470651, 62.255120951232506, 63.0174787277585, 63.7798365042845, 64.5421942808105, 65.30455205733651, 56.22705960326674, 56.99079798134962, 57.75453635943252, 58.518274737515405, 59.282013115598296, 60.045751493681195, 60.80948987176407, 61.57322824984696, 62.33696662792985, 63.100705006012745, 63.86444338409563, 55.009509943302504, 55.76488860516774, 56.52026726703298, 57.27564592889823, 58.031024590763465, 58.786403252628695, 59.54178191449394, 60.297160576359175, 61.05253923822442, 61.807917900089656, 62.56329656195489, 53.76972573193097, 54.50646564447081, 55.24320555701063, 55.97994546955047, 56.716685382090304, 57.45342529463014, 58.19016520716997, 58.9269051197098, 59.66364503224963, 60.40038494478947, 61.13712485732929, 52.73964025881221, 53.45148494939733, 54.163329639982464, 54.875174330567596, 55.587019021152734, 56.29886371173786, 57.01070840232299, 57.72255309290813, 58.43439778349326, 59.146242474078385, 59.85808716466353, 51.69906852069878, 52.37174447088816, 53.044420421077554, 53.71709637126693, 54.38977232145632, 55.06244827164571, 55.7351242218351, 56.40780017202448, 57.08047612221386, 57.75315207240325, 58.42582802259263, 50.791424989271654, 51.416733036612456, 52.04204108395325, 52.66734913129404, 53.29265717863483, 53.917965225975635, 54.54327327331644, 55.168581320657225, 55.79388936799802, 56.419197415338814, 57.044505462679616, 49.72728409988492, 50.33797472983262, 50.94866535978033, 51.559355989728026, 52.170046619675716, 52.78073724962342, 53.39142787957113, 54.00211850951882, 54.61280913946653, 55.22349976941422, 55.83419039936192, 48.804592230265555, 49.403161647952324, 50.001731065639106, 50.60030048332588, 51.19886990101267, 51.79743931869945, 52.39600873638622, 52.994578154073, 53.593147571759786, 54.19171698944657, 54.79028640713335, 47.81461738281856, 48.401455042085736, 48.988292701352925, 49.57513036062011, 50.16196801988729, 50.74880567915448, 51.335643338421654, 51.92248099768884, 52.509318656956026, 53.096156316223215, 53.68299397549038, 47.18864014886086, 47.76529851787311, 48.341956886885356, 48.918615255897606, 49.495273624909856, 50.071931993922114, 50.648590362934364, 51.22524873194661, 51.80190710095886, 52.378565469971115, 52.95522383898336, 46.54355743689971, 47.11048439728526, 47.67741135767082, 48.24433831805637, 48.81126527844192, 49.37819223882748, 49.945119199213025, 50.51204615959858, 51.078973119984134, 51.64590008036969, 52.21282704075525, 45.900734476058744, 46.45848222340253, 47.0162299707463, 47.57397771809009, 48.13172546543387, 48.689473212777656, 49.24722096012143, 49.80496870746522, 50.36271645480899, 50.92046420215277, 51.47821194949656, 45.17940587737775, 45.72809106273645, 46.27677624809517, 46.82546143345386, 47.37414661881257, 47.922831804171274, 48.47151698952998, 49.02020217488869, 49.56888736024739, 50.117572545606095, 50.666257730964794, 44.70085693249613, 45.24143315301286, 45.78200937352961, 46.322585594046345, 46.863161814563085, 47.40373803507983, 47.944314255596574, 48.4848904761133, 49.02546669663004, 49.56604291714678, 50.10661913766353, 44.22364990731329, 44.75659800124328, 45.28954609517328, 45.822494189103274, 46.35544228303326, 46.88839037696324, 47.421338470893225, 47.95428656482322, 48.487234658753216, 49.020182752683205, 49.553130846613186, 43.74628580729941, 44.27195887288214, 44.797631938464875, 45.32330500404761, 45.848978069630334, 46.37465113521308, 46.9003242007958, 47.425997266378545, 47.951670331961274, 48.477343397544004, 49.00301646312675, 43.40004139047822, 43.918908113063104, 44.437774835647986, 44.95664155823287, 45.47550828081775, 45.99437500340262, 46.513241725987506, 47.032108448572394, 47.550975171157276, 48.069841893742144, 48.58870861632703, 42.99275728760276, 43.50524089614446, 44.017724504686164, 44.530208113227864, 45.042691721769565, 45.555175330311265, 46.06765893885297, 46.58014254739467, 47.092626155936365, 47.605109764478065, 48.11759337301977, 42.76956088557493, 43.27616324805089, 43.78276561052685, 44.2893679730028, 44.79597033547876, 45.302572697954716, 45.80917506043067, 46.31577742290662, 46.82237978538259, 47.32898214785853, 47.8355845103345
]

cost_reduct = [0.5, 0.6, 0.7, 0.8, 0.9, 1.0, 1.1, 1.2, 1.3, 1.4, 1.5]
cost_summary = []
for _ in range(0, 21): 
    cost_summary += cost_reduct

split_and_plot(TIT[::-1], [x for x in LCOE[::-1]], cost_summary[::-1], savefig=True)


