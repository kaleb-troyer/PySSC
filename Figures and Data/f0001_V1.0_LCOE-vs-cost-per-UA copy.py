
import os
import utilities as ut
import matplotlib.pyplot as plt
import matplotlib.colors as mcolors
import matplotlib.patches as patches
from labellines import labelLines
from collections import defaultdict
from datetime import datetime

version = '1.0'
figID   = 'f0001'

def split_and_plot(delineators, y_values, x_values, objective=True, savefig=True):
    date = datetime.now()
    path = os.path.join(os.getcwd(), "Figures and Data")
    
    if objective: 
        baseline = 0.0648 * 1000
        plt.scatter(1.0, baseline, color='#333333', s=20, zorder=5, label="Baseline PHX")

    plt.legend()
    for line in plt.gca().get_lines():
        line.set_label(None)

    colors = ut.colorGenerator(factor=0.06)
    subsets = defaultdict(list)
    for i, d in enumerate(delineators):
        subsets[d].append(y_values[i])
    
    for i, (key, subset) in enumerate(subsets.items()):
        x_subset = x_values[:len(subset)]
        plt.plot(x_subset, subset, color=next(colors), label=f"{key:.0f}")
    
    labelLines(plt.gca().get_lines(), align=True, zorder=2.5, fontsize=6)

    firstColor = next(colors)
    lastColor  = '#6bffa9'
    firstTemp  = min(delineators)
    lastTemp   = max(delineators)

    cmap = mcolors.LinearSegmentedColormap.from_list("custom", [firstColor, lastColor])
    norm = mcolors.Normalize(vmin=firstTemp, vmax=lastTemp)

    cbar = plt.colorbar(plt.cm.ScalarMappable(norm=norm, cmap=cmap), ax=plt.gca())
    cbar.set_label('PHX Hot Inlet Temperature [C]')

    plt.xlabel(r'[\$ / UA(SiC)] / [\$ / UA(typ)]')
    plt.ylabel('Levelized Cost of Energy [$/MW-h]')
    plt.grid()
    plt.margins(x=0)

    if savefig: plt.savefig(os.path.join(path, "figures", f"{figID}_V{version}_LCOE-vs-cost-per-UA.png"), dpi=300, bbox_inches='tight')
    plt.show()

cost_model = [
    4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0, 4.0, 5.0, 6.0, 7.0, 8.0, 3.0, 9.0, 10.0, 11.0, 12.0, 13.0
]
LCOE = [
    0.07165796704113146, 0.0722762436551492, 0.07289452026916696, 0.07351279688318468, 0.07413107349720245, 0.0747493501112202, 0.07536762672523795, 0.0759859033392557, 0.07660417995327344, 0.07722245656729118, 0.07784073318130894, 0.06928061619198744, 0.06990457406082128, 0.07052853192965512, 0.07115248979848898, 0.07177644766732284, 0.07240040553615668, 0.07302436340499052, 0.07364832127382438, 0.07427227914265822, 0.07489623701149208, 0.07552019488032592, 0.06709063318946086, 0.06771540586409498, 0.06834017853872909, 0.06896495121336318, 0.0695897238879973, 0.07021449656263139, 0.0708392692372655, 0.07146404191189962, 0.07208881458653373, 0.07271358726116783, 0.07333835993580193, 0.06526191475463548, 0.06588081973986706, 0.06649972472509862, 0.06711862971033018, 0.06773753469556174, 0.06835643968079332, 0.0689753446660249, 0.06959424965125645, 0.070213154636488, 0.07083205962171958, 0.07145096460695115, 0.06344262757779608, 0.06404657203207396, 0.06465051648635187, 0.06525446094062974, 0.06585840539490764, 0.06646234984918553, 0.06706629430346342, 0.06767023875774132, 0.06827418321201921, 0.06887812766629708, 0.06948207212057499, 0.06190969982126534, 0.06249014103330471, 0.06307058224534408, 0.06365102345738344, 0.0642314646694228, 0.06481190588146216, 0.06539234709350153, 0.0659727883055409, 0.06655322951758026, 0.06713367072961962, 0.06771411194165901, 0.0604260840443288, 0.06097463922424272, 0.06152319440415665, 0.062071749584070565, 0.06262030476398449, 0.06316885994389841, 0.06371741512381232, 0.06426597030372624, 0.06481452548364017, 0.06536308066355408, 0.065911635843468, 0.05914304149345703, 0.05965317936245295, 0.06016331723144888, 0.06067345510044482, 0.061183592969440745, 0.06169373083843667, 0.062203868707432594, 0.06271400657642853, 0.06322414444542446, 0.0637342823144204, 0.06424442018341632, 0.05757213420356758, 0.058069827943117845, 0.05856752168266809, 0.059065215422218334, 0.05956290916176858, 0.06006060290131883, 0.06055829664086908, 0.06105599038041933, 0.061553684119969566, 0.06205137785951981, 0.06254907159907006, 0.056187832529253336, 0.056675225373109546, 0.057162618216965756, 0.05765001106082198, 0.0581374039046782, 0.058624796748534415, 0.05911218959239062, 0.059599582436246835, 0.06008697528010305, 0.06057436812395928, 0.06106176096781549, 0.05472600694461374, 0.05520333135664476, 0.055680655768675764, 0.05615798018070676, 0.05663530459273777, 0.057112629004768774, 0.05758995341679978, 0.05806727782883079, 0.05854460224086179, 0.0590219266528928, 0.0594992510649238, 0.05372700887927881, 0.05419585038355138, 0.05466469188782397, 0.05513353339209656, 0.05560237489636915, 0.056071216400641735, 0.056540057904914315, 0.057008899409186894, 0.05747774091345949, 0.057946582417732075, 0.058415423922004654, 0.052708199088446844, 0.05316887857890579, 0.05362955806936474, 0.054090237559823694, 0.05455091705028264, 0.05501159654074159, 0.05547227603120054, 0.0559329555216595, 0.056393635012118436, 0.056854314502577386, 0.05731499399303633, 0.051691649795495176, 0.052144579265199276, 0.052597508734903396, 0.05305043820460752, 0.053503367674311623, 0.05395629714401574, 0.05440922661371984, 0.054862156083423964, 0.05531508555312807, 0.05576801502283217, 0.056220944492536284, 0.050579536634744654, 0.05102473054904272, 0.05146992446334077, 0.051915118377638826, 0.052360312291936884, 0.05280550620623495, 0.05325070012053301, 0.05369589403483106, 0.05414108794912912, 0.05458628186342718, 0.05503147577772524, 0.04976482439069485, 0.050203247505891294, 0.05064167062108772, 0.05108009373628416, 0.051518516851480595, 0.05195693996667704, 0.05239536308187348, 0.0528337861970699, 0.05327220931226634, 0.053710632427462775, 0.054149055542659204, 0.04895437302147755, 0.049386391116949147, 0.04981840921242073, 0.05025042730789232, 0.05068244540336391, 0.05111446349883549, 0.0515464815943071, 0.05197849968977868, 0.05241051778525027, 0.05284253588072187, 0.05327455397619346, 0.048144757168535016, 0.04857064069497544, 0.04899652422141585, 0.049422407747856265, 0.04984829127429669, 0.050274174800737106, 0.050700058327177534, 0.05112594185361796, 0.051551825380058376, 0.0519777089064988, 0.052403592432939225, 0.047488128317322985, 0.04790834560753587, 0.048328562897748756, 0.04874878018796164, 0.04916899747817453, 0.04958921476838741, 0.0500094320586003, 0.05042964934881318, 0.05084986663902607, 0.05127008392923895, 0.051690301219451826, 0.04675902146903648, 0.04717383603457008, 0.047588650600103664, 0.04800346516563725, 0.04841827973117085, 0.04883309429670444, 0.049247908862238024, 0.049662723427771616, 0.0500775379933052, 0.05049235255883879, 0.05090716712437239, 0.04624425328442619, 0.04665420274820925, 0.04706415221199233, 0.047474101675775385, 0.04788405113955845, 0.04829400060334151, 0.048703950067124586, 0.04911389953090765, 0.04952384899469071, 0.049933798458473774, 0.05034374792225684
]
TIT = [
    600.0, 600.0, 600.0, 600.0, 600.0, 600.0, 600.0, 600.0, 600.0, 600.0, 600.0, 620.0, 620.0, 620.0, 620.0, 620.0, 620.0, 620.0, 620.0, 620.0, 620.0, 620.0, 640.0, 640.0, 640.0, 640.0, 640.0, 640.0, 640.0, 640.0, 640.0, 640.0, 640.0, 660.0, 660.0, 660.0, 660.0, 660.0, 660.0, 660.0, 660.0, 660.0, 660.0, 660.0, 680.0, 680.0, 680.0, 680.0, 680.0, 680.0, 680.0, 680.0, 680.0, 680.0, 680.0, 700.0, 700.0, 700.0, 700.0, 700.0, 700.0, 700.0, 700.0, 700.0, 700.0, 700.0, 720.0, 720.0, 720.0, 720.0, 720.0, 720.0, 720.0, 720.0, 720.0, 720.0, 720.0, 740.0, 740.0, 740.0, 740.0, 740.0, 740.0, 740.0, 740.0, 740.0, 740.0, 740.0, 760.0, 760.0, 760.0, 760.0, 760.0, 760.0, 760.0, 760.0, 760.0, 760.0, 760.0, 780.0, 780.0, 780.0, 780.0, 780.0, 780.0, 780.0, 780.0, 780.0, 780.0, 780.0, 800.0, 800.0, 800.0, 800.0, 800.0, 800.0, 800.0, 800.0, 800.0, 800.0, 800.0, 820.0, 820.0, 820.0, 820.0, 820.0, 820.0, 820.0, 820.0, 820.0, 820.0, 820.0, 840.0, 840.0, 840.0, 840.0, 840.0, 840.0, 840.0, 840.0, 840.0, 840.0, 840.0, 860.0, 860.0, 860.0, 860.0, 860.0, 860.0, 860.0, 860.0, 860.0, 860.0, 860.0, 880.0, 880.0, 880.0, 880.0, 880.0, 880.0, 880.0, 880.0, 880.0, 880.0, 880.0, 900.0, 900.0, 900.0, 900.0, 900.0, 900.0, 900.0, 900.0, 900.0, 900.0, 900.0, 920.0, 920.0, 920.0, 920.0, 920.0, 920.0, 920.0, 920.0, 920.0, 920.0, 920.0, 940.0, 940.0, 940.0, 940.0, 940.0, 940.0, 940.0, 940.0, 940.0, 940.0, 940.0, 960.0, 960.0, 960.0, 960.0, 960.0, 960.0, 960.0, 960.0, 960.0, 960.0, 960.0, 980.0, 980.0, 980.0, 980.0, 980.0, 980.0, 980.0, 980.0, 980.0, 980.0, 980.0, 1000.0, 1000.0, 1000.0, 1000.0, 1000.0, 1000.0, 1000.0, 1000.0, 1000.0, 1000.0, 1000.0
]

cost_reduct = [0.5, 0.6, 0.7, 0.8, 0.9, 1.0, 1.1, 1.2, 1.3, 1.4, 1.5]
cost_summary = []
for _ in range(0, 21): 
    cost_summary += cost_reduct

split_and_plot(TIT[::-1], [x * 1000 for x in LCOE[::-1]], cost_summary[::-1], savefig=True)


